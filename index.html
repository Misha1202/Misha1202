import openpyxl
import requests
import json

# Настройки
EXCEL_FILE = 'Книга1202.xlsx'  # Укажите путь к вашему файлу Excel
SHEET_NAME = 'Лист1'          # Укажите название листа
API_URL = "https://wms.wbwh.tech/srv/wms_front_wbstorenv_place_info_api_proxy_adapter/api/storage_places/by_name_and_office"
API_TOKEN = "eyJhbGciOiJSUzI1NiJ9.eyJlbXBsb3llZV9pZCI6IjI5NzM2MSIsImV4cCI6MTc0NzA1ODA0NSwiaWF0IjoxNzQ3MDUwODMwLCJwaG9uZSI6IiIsInNlc3Npb25faWQiOiI1MTY2Mzk2My1jMWQ2LTRlYzQtNjA3OS0wZGUyM2M2YTllY2YifQ.nfPBbz6dd-qJ8-_6kZc1-DSecFMvlVDx2gxOsPO6ruI8Ey6jtOqL03YScSEoTYDk34qMN4AMlsAnZJ7ojVMplGpFh8sA2FTWZ2WrxpSt_QQAjJTviNFlwp-Nwq2NA1XKIojbJpdmmjCg6JzUZOgMOC-qmtLaJwENkLJM84NwokQ"       # Замените на ваш реальный токен
OFFICE_ID = 507               # ID офиса из вашего примера

def получить_place_id(название_места):
    """Функция для получения place_id из API по названию места"""
    заголовки = {
        "Authorization": f"Bearer {API_TOKEN}",
        "Content-Type": "application/json"
    }
    
    данные = {
        "place_name": название_места,
        "office_id": OFFICE_ID
    }
    
    try:
        ответ = requests.post(API_URL, headers=заголовки, data=json.dumps(данные))
        ответ.raise_for_status()  # Проверка на ошибки
        
        результат = ответ.json()
        if результат.get('data') and len(результат['data']) > 0:
            return результат['data'][0]['place_id']
        return None
    except requests.exceptions.RequestException as e:
        print(f"Ошибка при запросе place_id для {название_места}: {e}")
        return None

def обработать_excel_файл():
    """Основная функция обработки Excel файла"""
    # Открываем файл Excel
    книга = openpyxl.load_workbook(EXCEL_FILE)
    лист = книга[SHEET_NAME]
    
    # Обрабатываем каждую строку в столбце B
    for строка in лист.iter_rows(min_col=2, max_col=2):  # Столбец B
        ячейка = строка[0]
        if ячейка.value:  # Если есть название места
            place_id = получить_place_id(str(ячейка.value).strip())
            лист.cell(row=ячейка.row, column=1, value=place_id)  # Записываем в столбец A
    
    # Сохраняем изменения
    книга.save(EXCEL_FILE)
    print("Обработка завершена!")

if __name__ == "__main__":
    обработать_excel_файл()
